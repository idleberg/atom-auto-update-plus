"use strict";var e=require("atom"),t=require("path"),n=require("child_process"),r=require("fs"),i=require("os"),o=require("assert"),a=require("events"),s=require("buffer"),c=require("stream"),u=require("util");function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=l(t),p=l(n),f=l(r),m=l(i),h=l(o),E=l(a),g=l(s),v=l(c),I=l(u);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function y(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))}function R(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var S="auto-update-plus",w=S;
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function b(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e}var T=new(function(){function e(e){void 0===e&&(e={}),this.name=e.name,this.styleSheet="\n      background-color: "+(e.backgroundColor||"darkgrey")+";\n      border-radius: 2px;\n      color: "+(e.color||"white")+";\n      line-height: 1.5;\n      padding: 1px 4px;\n      text-shadow: 0 1px 0px rgba(0, 0, 0, 0.2);\n    "}return e.prototype.__console__=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];(null===atom||void 0===atom?void 0:atom.inDevMode())&&(n.unshift("%c"+this.name+"%c",this.styleSheet,""),(t=window.console)[e].apply(t,n))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.__console__.apply(this,b(["debug"],e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.__console__.apply(this,b(["error"],e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.__console__.apply(this,b(["info"],e))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.__console__.apply(this,b(["log"],e))},e.prototype.trace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.__console__.apply(this,b(["trace"],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.__console__.apply(this,b(["warn"],e))},e}())({name:w,backgroundColor:"indianred"}),O=360,N=15,L=10080,A={includedPackages:{title:"Included Packages",description:"Comma-delimited list of packages to be included from automatic updates. Don't mix with *Excluded Packages* – included packages take precedence over excluded packages.",type:"array",default:[],order:1},excludedPackages:{title:"Excluded Packages",description:"Comma-delimited list of packages to be excluded from automatic updates. Don't mix with *Included Packages* – included packages take precedence over excluded packages.",type:"array",default:[],order:2},versionRange:{title:"Version Range",description:"Specify a [SemVer](https://semver.org/) range that update automatically",type:"array",default:["major","minor","patch"],enum:[{value:["patch"],description:"Patch only"},{value:["minor","patch"],description:"Minor or below"},{value:["major","minor","patch"],description:"Major or below (all versions)"},{value:["major","minor"],description:"⚠️ Minor or above"},{value:["major"],description:"⚠️ Major only"}],order:2},intervalMinutes:{title:"Update Interval",description:"Set the default update interval, in minutes",type:"integer",minimum:atom.inDevMode()?1:N,maximum:L,default:O,order:3},deferInitialization:{title:"Defer Initialization",description:"Set the default timeout for update initialization, in seconds",type:"integer",minimum:atom.inDevMode()?1:5,maximum:120,default:10,order:3},hideUpdateStatusView:{title:"Hide Update Status",description:"Hides Atom's default update indicator in the status bar",type:"boolean",default:!1,order:4},notifications:{title:"Notifications",type:"object",order:5,properties:{notifyOnUpdate:{title:"Notify on Update",description:"Enable to show notifications when packages have been updated",type:"boolean",default:!0,order:1},dismissNotification:{title:"Dismiss Notification",description:"Automatically dismiss the update notification after 5 seconds",type:"boolean",default:!0,order:2},maximumPackageDetail:{title:"Maximum Package Detail",description:"Specify the maximum number of package names displayed in the notification (minimum is 3)",type:"integer",default:5,minimum:3,maximum:20,order:3}}}};function x(e){return void 0===e&&(e=""),(null==e?void 0:e.length)?atom.config.get(S+"."+e):atom.config.get(""+S)}function P(e,t){if(atom.config.get(S+"."+e)&&!atom.config.get(S+"."+t)){try{atom.config.set(S+"."+t,atom.config.get(S+"."+e))}catch(e){return T.error(e),void atom.notifications.addWarning("Failed to migrate configuration, see console for details")}T.warn("The configuration setting '"+e+"' was migrated successfully to '"+t+"'"),atom.config.unset(S+"."+e)}else T.warn("The configuration setting '"+t+"' already exists, skipping migration")}var C="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function G(e){var t={exports:{}};return e(t,t.exports),t.exports}var D=k;function M(e,t,n){return!(!e.isSymbolicLink()&&!e.isFile())&&function(e,t){var n=void 0!==t.pathExt?t.pathExt:process.env.PATHEXT;if(!n)return!0;if(-1!==(n=n.split(";")).indexOf(""))return!0;for(var r=0;r<n.length;r++){var i=n[r].toLowerCase();if(i&&e.substr(-i.length).toLowerCase()===i)return!0}return!1}(t,n)}function k(e,t,n){f.default.stat(e,(function(r,i){n(r,!r&&M(i,e,t))}))}k.sync=function(e,t){return M(f.default.statSync(e),e,t)};var j,U=_;function _(e,t,n){f.default.stat(e,(function(e,r){n(e,!e&&F(r,t))}))}function F(e,t){return e.isFile()&&function(e,t){var n=e.mode,r=e.uid,i=e.gid,o=void 0!==t.uid?t.uid:process.getuid&&process.getuid(),a=void 0!==t.gid?t.gid:process.getgid&&process.getgid(),s=parseInt("100",8),c=parseInt("010",8),u=parseInt("001",8),l=s|c;return n&u||n&c&&i===a||n&s&&r===o||n&l&&0===o}(e,t)}_.sync=function(e,t){return F(f.default.statSync(e),t)},j="win32"===process.platform||C.TESTING_WINDOWS?D:U;var $=B;function B(e,t,n){if("function"==typeof t&&(n=t,t={}),!n){if("function"!=typeof Promise)throw new TypeError("callback not provided");return new Promise((function(n,r){B(e,t||{},(function(e,t){e?r(e):n(t)}))}))}j(e,t||{},(function(e,r){e&&("EACCES"===e.code||t&&t.ignoreErrors)&&(e=null,r=!1),n(e,r)}))}B.sync=function(e,t){try{return j.sync(e,t||{})}catch(e){if(t&&t.ignoreErrors||"EACCES"===e.code)return!1;throw e}};const X="win32"===process.platform||"cygwin"===process.env.OSTYPE||"msys"===process.env.OSTYPE,V=X?";":":",H=e=>Object.assign(new Error(`not found: ${e}`),{code:"ENOENT"}),q=(e,t)=>{const n=t.colon||V,r=e.match(/\//)||X&&e.match(/\\/)?[""]:[...X?[process.cwd()]:[],...(t.path||process.env.PATH||"").split(n)],i=X?t.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",o=X?i.split(n):[""];return X&&-1!==e.indexOf(".")&&""!==o[0]&&o.unshift(""),{pathEnv:r,pathExt:o,pathExtExe:i}},K=(e,t,n)=>{"function"==typeof t&&(n=t,t={}),t||(t={});const{pathEnv:r,pathExt:i,pathExtExe:o}=q(e,t),a=[],s=n=>new Promise(((i,o)=>{if(n===r.length)return t.all&&a.length?i(a):o(H(e));const s=r[n],u=/^".*"$/.test(s)?s.slice(1,-1):s,l=d.default.join(u,e),p=!u&&/^\.[\\\/]/.test(e)?e.slice(0,2)+l:l;i(c(p,n,0))})),c=(e,n,r)=>new Promise(((u,l)=>{if(r===i.length)return u(s(n+1));const d=i[r];$(e+d,{pathExt:o},((i,o)=>{if(!i&&o){if(!t.all)return u(e+d);a.push(e+d)}return u(c(e,n,r+1))}))}));return n?s(0).then((e=>n(null,e)),n):s(0)};var W=K;K.sync=(e,t)=>{t=t||{};const{pathEnv:n,pathExt:r,pathExtExe:i}=q(e,t),o=[];for(let a=0;a<n.length;a++){const s=n[a],c=/^".*"$/.test(s)?s.slice(1,-1):s,u=d.default.join(c,e),l=!c&&/^\.[\\\/]/.test(e)?e.slice(0,2)+u:u;for(let e=0;e<r.length;e++){const n=l+r[e];try{if($.sync(n,{pathExt:i})){if(!t.all)return n;o.push(n)}}catch(e){}}}if(t.all&&o.length)return o;if(t.nothrow)return null;throw H(e)};const z=(e={})=>{const t=e.env||process.env;return"win32"!==(e.platform||process.platform)?"PATH":Object.keys(t).reverse().find((e=>"PATH"===e.toUpperCase()))||"Path"};var Y=z,Z=z;function Q(e,t){const n=e.options.env||process.env,r=process.cwd(),i=null!=e.options.cwd,o=i&&void 0!==process.chdir&&!process.chdir.disabled;if(o)try{process.chdir(e.options.cwd)}catch(e){}let a;try{a=W.sync(e.command,{path:n[Y({env:n})],pathExt:t?d.default.delimiter:void 0})}catch(e){}finally{o&&process.chdir(r)}return a&&(a=d.default.resolve(i?e.options.cwd:"",a)),a}Y.default=Z;var J=function(e){return Q(e)||Q(e,!0)};const ee=/([()\][%!^"`<>&|;, *?])/g;var te={command:function(e){return e=e.replace(ee,"^$1")},argument:function(e,t){return e=(e=`"${e=(e=(e=`${e}`).replace(/(\\*)"/g,'$1$1\\"')).replace(/(\\*)$/,"$1$1")}"`).replace(ee,"^$1"),t&&(e=e.replace(ee,"^$1")),e}},ne=/^#!(.*)/;var re=function(e){const t=Buffer.alloc(150);let n;try{n=f.default.openSync(e,"r"),f.default.readSync(n,t,0,150,0),f.default.closeSync(n)}catch(e){}return((e="")=>{const t=e.match(ne);if(!t)return null;const[n,r]=t[0].replace(/#! ?/,"").split(" "),i=n.split("/").pop();return"env"===i?r:r?`${i} ${r}`:i})(t.toString())};const ie="win32"===process.platform,oe=/\.(?:com|exe)$/i,ae=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function se(e){if(!ie)return e;const t=function(e){e.file=J(e);const t=e.file&&re(e.file);return t?(e.args.unshift(e.file),e.command=t,J(e)):e.file}(e),n=!oe.test(t);if(e.options.forceShell||n){const n=ae.test(t);e.command=d.default.normalize(e.command),e.command=te.command(e.command),e.args=e.args.map((e=>te.argument(e,n)));const r=[e.command].concat(e.args).join(" ");e.args=["/d","/s","/c",`"${r}"`],e.command=process.env.comspec||"cmd.exe",e.options.windowsVerbatimArguments=!0}return e}var ce=function(e,t,n){t&&!Array.isArray(t)&&(n=t,t=null);const r={command:e,args:t=t?t.slice(0):[],options:n=Object.assign({},n),file:void 0,original:{command:e,args:t}};return n.shell?r:se(r)};const ue="win32"===process.platform;function le(e,t){return Object.assign(new Error(`${t} ${e.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${t} ${e.command}`,path:e.command,spawnargs:e.args})}function de(e,t){return ue&&1===e&&!t.file?le(t.original,"spawn"):null}var pe={hookChildProcess:function(e,t){if(!ue)return;const n=e.emit;e.emit=function(r,i){if("exit"===r){const r=de(i,t);if(r)return n.call(e,"error",r)}return n.apply(e,arguments)}},verifyENOENT:de,verifyENOENTSync:function(e,t){return ue&&1===e&&!t.file?le(t.original,"spawnSync"):null},notFoundError:le};function fe(e,t,n){const r=ce(e,t,n),i=p.default.spawn(r.command,r.args,r.options);return pe.hookChildProcess(i,r),i}var me=fe,he=fe,Ee=function(e,t,n){const r=ce(e,t,n),i=p.default.spawnSync(r.command,r.args,r.options);return i.error=i.error||pe.verifyENOENTSync(i.status,r),i},ge=ce,ve=pe;me.spawn=he,me.sync=Ee,me._parse=ge,me._enoent=ve;var Ie=G((function(e){const t=e=>{let t;e={cwd:process.cwd(),path:process.env[Y()],execPath:process.execPath,...e};let n=d.default.resolve(e.cwd);const r=[];for(;t!==n;)r.push(d.default.join(n,"node_modules/.bin")),t=n,n=d.default.resolve(n,"..");const i=d.default.resolve(e.cwd,e.execPath,"..");return r.push(i),r.concat(e.path).join(d.default.delimiter)};e.exports=t,e.exports.default=t,e.exports.env=t=>{const n={...(t={env:process.env,...t}).env},r=Y({env:n});return t.path=n[r],n[r]=e.exports(t),n}}));const ye=(e,t)=>{for(const n of Reflect.ownKeys(t))Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n));return e};var Re=ye,Se=ye;Re.default=Se;const we=new WeakMap,be=(e,t={})=>{if("function"!=typeof e)throw new TypeError("Expected a function");let n,r=0;const i=e.displayName||e.name||"<anonymous>",o=function(...a){if(we.set(o,++r),1===r)n=e.apply(this,a),e=null;else if(!0===t.throw)throw new Error(`Function \`${i}\` can only be called once`);return n};return Re(o,e),we.set(o,r),o};var Te=be,Oe=be;Te.default=Oe,Te.callCount=e=>{if(!we.has(e))throw new Error(`The given function \`${e.name}\` is not wrapped by the \`onetime\` package`);return we.get(e)};var Ne=G((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SIGNALS=void 0;t.SIGNALS=[{name:"SIGHUP",number:1,action:"terminate",description:"Terminal closed",standard:"posix"},{name:"SIGINT",number:2,action:"terminate",description:"User interruption with CTRL-C",standard:"ansi"},{name:"SIGQUIT",number:3,action:"core",description:"User interruption with CTRL-\\",standard:"posix"},{name:"SIGILL",number:4,action:"core",description:"Invalid machine instruction",standard:"ansi"},{name:"SIGTRAP",number:5,action:"core",description:"Debugger breakpoint",standard:"posix"},{name:"SIGABRT",number:6,action:"core",description:"Aborted",standard:"ansi"},{name:"SIGIOT",number:6,action:"core",description:"Aborted",standard:"bsd"},{name:"SIGBUS",number:7,action:"core",description:"Bus error due to misaligned, non-existing address or paging error",standard:"bsd"},{name:"SIGEMT",number:7,action:"terminate",description:"Command should be emulated but is not implemented",standard:"other"},{name:"SIGFPE",number:8,action:"core",description:"Floating point arithmetic error",standard:"ansi"},{name:"SIGKILL",number:9,action:"terminate",description:"Forced termination",standard:"posix",forced:!0},{name:"SIGUSR1",number:10,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGSEGV",number:11,action:"core",description:"Segmentation fault",standard:"ansi"},{name:"SIGUSR2",number:12,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGPIPE",number:13,action:"terminate",description:"Broken pipe or socket",standard:"posix"},{name:"SIGALRM",number:14,action:"terminate",description:"Timeout or timer",standard:"posix"},{name:"SIGTERM",number:15,action:"terminate",description:"Termination",standard:"ansi"},{name:"SIGSTKFLT",number:16,action:"terminate",description:"Stack is empty or overflowed",standard:"other"},{name:"SIGCHLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"posix"},{name:"SIGCLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"other"},{name:"SIGCONT",number:18,action:"unpause",description:"Unpaused",standard:"posix",forced:!0},{name:"SIGSTOP",number:19,action:"pause",description:"Paused",standard:"posix",forced:!0},{name:"SIGTSTP",number:20,action:"pause",description:'Paused using CTRL-Z or "suspend"',standard:"posix"},{name:"SIGTTIN",number:21,action:"pause",description:"Background process cannot read terminal input",standard:"posix"},{name:"SIGBREAK",number:21,action:"terminate",description:"User interruption with CTRL-BREAK",standard:"other"},{name:"SIGTTOU",number:22,action:"pause",description:"Background process cannot write to terminal output",standard:"posix"},{name:"SIGURG",number:23,action:"ignore",description:"Socket received out-of-band data",standard:"bsd"},{name:"SIGXCPU",number:24,action:"core",description:"Process timed out",standard:"bsd"},{name:"SIGXFSZ",number:25,action:"core",description:"File too big",standard:"bsd"},{name:"SIGVTALRM",number:26,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGPROF",number:27,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGWINCH",number:28,action:"ignore",description:"Terminal window size changed",standard:"bsd"},{name:"SIGIO",number:29,action:"terminate",description:"I/O is available",standard:"other"},{name:"SIGPOLL",number:29,action:"terminate",description:"Watched event",standard:"other"},{name:"SIGINFO",number:29,action:"ignore",description:"Request for process information",standard:"other"},{name:"SIGPWR",number:30,action:"terminate",description:"Device running out of power",standard:"systemv"},{name:"SIGSYS",number:31,action:"core",description:"Invalid system call",standard:"other"},{name:"SIGUNUSED",number:31,action:"terminate",description:"Invalid system call",standard:"other"}]})),Le=G((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SIGRTMAX=t.getRealtimeSignals=void 0;t.getRealtimeSignals=function(){const e=i-r+1;return Array.from({length:e},n)};const n=function(e,t){return{name:`SIGRT${t+1}`,number:r+t,action:"terminate",description:"Application-specific signal (realtime)",standard:"posix"}},r=34,i=64;t.SIGRTMAX=i})),Ae=G((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getSignals=void 0;t.getSignals=function(){const e=(0,Le.getRealtimeSignals)();return[...Ne.SIGNALS,...e].map(n)};const n=function({name:e,number:t,description:n,action:r,forced:i=!1,standard:o}){const{signals:{[e]:a}}=m.default.constants,s=void 0!==a;return{name:e,number:s?a:t,description:n,supported:s,action:r,forced:i,standard:o}}})),xe=G((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.signalsByNumber=t.signalsByName=void 0;const n=function(e,{name:t,number:n,description:r,supported:i,action:o,forced:a,standard:s}){return{...e,[t]:{name:t,number:n,description:r,supported:i,action:o,forced:a,standard:s}}},r=(0,Ae.getSignals)().reduce(n,{});t.signalsByName=r;const i=function(e,t){const n=o(e,t);if(void 0===n)return{};const{name:r,description:i,supported:a,action:s,forced:c,standard:u}=n;return{[e]:{name:r,number:e,description:i,supported:a,action:s,forced:c,standard:u}}},o=function(e,t){const n=t.find((({name:t})=>m.default.constants.signals[t]===e));return void 0!==n?n:t.find((t=>t.number===e))},a=function(){const e=(0,Ae.getSignals)(),t=Le.SIGRTMAX+1,n=Array.from({length:t},((t,n)=>i(n,e)));return Object.assign({},...n)}();t.signalsByNumber=a}));const{signalsByName:Pe}=xe;var Ce=({stdout:e,stderr:t,all:n,error:r,signal:i,exitCode:o,command:a,timedOut:s,isCanceled:c,killed:u,parsed:{options:{timeout:l}}})=>{o=null===o?void 0:o;const d=void 0===(i=null===i?void 0:i)?void 0:Pe[i].description,p=`Command ${(({timedOut:e,timeout:t,errorCode:n,signal:r,signalDescription:i,exitCode:o,isCanceled:a})=>e?`timed out after ${t} milliseconds`:a?"was canceled":void 0!==n?`failed with ${n}`:void 0!==r?`was killed with ${r} (${i})`:void 0!==o?`failed with exit code ${o}`:"failed")({timedOut:s,timeout:l,errorCode:r&&r.code,signal:i,signalDescription:d,exitCode:o,isCanceled:c})}: ${a}`,f="[object Error]"===Object.prototype.toString.call(r),m=f?`${p}\n${r.message}`:p,h=[m,t,e].filter(Boolean).join("\n");return f?(r.originalMessage=r.message,r.message=h):r=new Error(h),r.shortMessage=m,r.command=a,r.exitCode=o,r.signal=i,r.signalDescription=d,r.stdout=e,r.stderr=t,void 0!==n&&(r.all=n),"bufferedData"in r&&delete r.bufferedData,r.failed=!0,r.timedOut=Boolean(s),r.isCanceled=c,r.killed=u&&!s,r};const Ge=["stdin","stdout","stderr"],De=e=>{if(!e)return;const{stdio:t}=e;if(void 0===t)return Ge.map((t=>e[t]));if((e=>Ge.some((t=>void 0!==e[t])))(e))throw new Error(`It's not possible to provide \`stdio\` in combination with one of ${Ge.map((e=>`\`${e}\``)).join(", ")}`);if("string"==typeof t)return t;if(!Array.isArray(t))throw new TypeError(`Expected \`stdio\` to be of type \`string\` or \`Array\`, got \`${typeof t}\``);const n=Math.max(t.length,Ge.length);return Array.from({length:n},((e,n)=>t[n]))};var Me=De;Me.node=e=>{const t=De(e);return"ipc"===t?"ipc":void 0===t||"string"==typeof t?[t,t,t,"ipc"]:t.includes("ipc")?t:[...t,"ipc"]};var ke,je=G((function(e){e.exports=["SIGABRT","SIGALRM","SIGHUP","SIGINT","SIGTERM"],"win32"!==process.platform&&e.exports.push("SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),"linux"===process.platform&&e.exports.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT","SIGUNUSED")})),Ue=/^win/i.test(process.platform),_e=E.default;"function"!=typeof _e&&(_e=_e.EventEmitter),process.__signal_exit_emitter__?ke=process.__signal_exit_emitter__:((ke=process.__signal_exit_emitter__=new _e).count=0,ke.emitted={}),ke.infinite||(ke.setMaxListeners(1/0),ke.infinite=!0);var Fe=function(e,t){h.default.equal(typeof e,"function","a callback must be provided for exit handler"),!1===qe&&Ke();var n="exit";t&&t.alwaysLast&&(n="afterexit");return ke.on(n,e),function(){ke.removeListener(n,e),0===ke.listeners("exit").length&&0===ke.listeners("afterexit").length&&Be()}},$e=Be;function Be(){qe&&(qe=!1,je.forEach((function(e){try{process.removeListener(e,Ve[e])}catch(e){}})),process.emit=Ye,process.reallyExit=We,ke.count-=1)}function Xe(e,t,n){ke.emitted[e]||(ke.emitted[e]=!0,ke.emit(e,t,n))}var Ve={};je.forEach((function(e){Ve[e]=function(){process.listeners(e).length===ke.count&&(Be(),Xe("exit",null,e),Xe("afterexit",null,e),Ue&&"SIGHUP"===e&&(e="SIGINT"),process.kill(process.pid,e))}}));var He=Ke,qe=!1;function Ke(){qe||(qe=!0,ke.count+=1,je=je.filter((function(e){try{return process.on(e,Ve[e]),!0}catch(e){return!1}})),process.emit=Ze,process.reallyExit=ze)}var We=process.reallyExit;function ze(e){process.exitCode=e||0,Xe("exit",process.exitCode,null),Xe("afterexit",process.exitCode,null),We.call(process,process.exitCode)}var Ye=process.emit;function Ze(e,t){if("exit"===e){void 0!==t&&(process.exitCode=t);var n=Ye.apply(this,arguments);return Xe("exit",process.exitCode,null),Xe("afterexit",process.exitCode,null),n}return Ye.apply(this,arguments)}Fe.unload=$e,Fe.signals=function(){return je},Fe.load=He;const Qe=(e,t,n,r)=>{if(!Je(t,n,r))return;const i=tt(n),o=setTimeout((()=>{e("SIGKILL")}),i);o.unref&&o.unref()},Je=(e,{forceKillAfterTimeout:t},n)=>et(e)&&!1!==t&&n,et=e=>e===m.default.constants.signals.SIGTERM||"string"==typeof e&&"SIGTERM"===e.toUpperCase(),tt=({forceKillAfterTimeout:e=!0})=>{if(!0===e)return 5e3;if(!Number.isFinite(e)||e<0)throw new TypeError(`Expected the \`forceKillAfterTimeout\` option to be a non-negative integer, got \`${e}\` (${typeof e})`);return e};var nt={spawnedKill:(e,t="SIGTERM",n={})=>{const r=e(t);return Qe(e,t,n,r),r},spawnedCancel:(e,t)=>{e.kill()&&(t.isCanceled=!0)},setupTimeout:(e,{timeout:t,killSignal:n="SIGTERM"},r)=>{if(0===t||void 0===t)return r;if(!Number.isFinite(t)||t<0)throw new TypeError(`Expected the \`timeout\` option to be a non-negative integer, got \`${t}\` (${typeof t})`);let i;const o=new Promise(((r,o)=>{i=setTimeout((()=>{((e,t,n)=>{e.kill(t),n(Object.assign(new Error("Timed out"),{timedOut:!0,signal:t}))})(e,n,o)}),t)})),a=r.finally((()=>{clearTimeout(i)}));return Promise.race([o,a])},setExitHandler:async(e,{cleanup:t,detached:n},r)=>{if(!t||n)return r;const i=Fe((()=>{e.kill()}));return r.finally((()=>{i()}))}};const rt=e=>null!==e&&"object"==typeof e&&"function"==typeof e.pipe;rt.writable=e=>rt(e)&&!1!==e.writable&&"function"==typeof e._write&&"object"==typeof e._writableState,rt.readable=e=>rt(e)&&!1!==e.readable&&"function"==typeof e._read&&"object"==typeof e._readableState,rt.duplex=e=>rt.writable(e)&&rt.readable(e),rt.transform=e=>rt.duplex(e)&&"function"==typeof e._transform&&"object"==typeof e._transformState;var it=rt;const{PassThrough:ot}=v.default;const{constants:at}=g.default,{promisify:st}=I.default,ct=st(v.default.pipeline);class ut extends Error{constructor(){super("maxBuffer exceeded"),this.name="MaxBufferError"}}async function lt(e,t){if(!e)throw new Error("Expected a stream");t={maxBuffer:1/0,...t};const{maxBuffer:n}=t,r=(e=>{e={...e};const{array:t}=e;let{encoding:n}=e;const r="buffer"===n;let i=!1;t?i=!(n||r):n=n||"utf8",r&&(n=null);const o=new ot({objectMode:i});n&&o.setEncoding(n);let a=0;const s=[];return o.on("data",(e=>{s.push(e),i?a=s.length:a+=e.length})),o.getBufferedValue=()=>t?s:r?Buffer.concat(s,a):s.join(""),o.getBufferedLength=()=>a,o})(t);return await new Promise(((t,i)=>{const o=e=>{e&&r.getBufferedLength()<=at.MAX_LENGTH&&(e.bufferedData=r.getBufferedValue()),i(e)};(async()=>{try{await ct(e,r),t()}catch(e){o(e)}})(),r.on("data",(()=>{r.getBufferedLength()>n&&o(new ut)}))})),r.getBufferedValue()}var dt=lt,pt=ut;dt.buffer=(e,t)=>lt(e,{...t,encoding:"buffer"}),dt.array=(e,t)=>lt(e,{...t,array:!0}),dt.MaxBufferError=pt;const{PassThrough:ft}=v.default;const mt=async(e,t)=>{if(e){e.destroy();try{return await t}catch(e){return e.bufferedData}}},ht=(e,{encoding:t,buffer:n,maxBuffer:r})=>{if(e&&n)return t?dt(e,{encoding:t,maxBuffer:r}):dt.buffer(e,{maxBuffer:r})};var Et={handleInput:(e,t)=>{void 0!==t&&void 0!==e.stdin&&(it(t)?t.pipe(e.stdin):e.stdin.end(t))},makeAllStream:(e,{all:t})=>{if(!t||!e.stdout&&!e.stderr)return;const n=function(){var e=[],t=new ft({objectMode:!0});return t.setMaxListeners(0),t.add=n,t.isEmpty=r,t.on("unpipe",i),Array.prototype.slice.call(arguments).forEach(n),t;function n(r){return Array.isArray(r)?(r.forEach(n),this):(e.push(r),r.once("end",i.bind(null,r)),r.once("error",t.emit.bind(t,"error")),r.pipe(t,{end:!1}),this)}function r(){return 0==e.length}function i(n){!(e=e.filter((function(e){return e!==n}))).length&&t.readable&&t.end()}}();return e.stdout&&n.add(e.stdout),e.stderr&&n.add(e.stderr),n},getSpawnedResult:async({stdout:e,stderr:t,all:n},{encoding:r,buffer:i,maxBuffer:o},a)=>{const s=ht(e,{encoding:r,buffer:i,maxBuffer:o}),c=ht(t,{encoding:r,buffer:i,maxBuffer:o}),u=ht(n,{encoding:r,buffer:i,maxBuffer:2*o});try{return await Promise.all([a,s,c,u])}catch(r){return Promise.all([{error:r,signal:r.signal,timedOut:r.timedOut},mt(e,s),mt(t,c),mt(n,u)])}},validateInputSync:({input:e})=>{if(it(e))throw new TypeError("The `input` option cannot be a stream in sync mode")}};const gt=(async()=>{})().constructor.prototype,vt=["then","catch","finally"].map((e=>[e,Reflect.getOwnPropertyDescriptor(gt,e)]));var It={mergePromise:(e,t)=>{for(const[n,r]of vt){const i="function"==typeof t?(...e)=>Reflect.apply(r.value,t(),e):r.value.bind(t);Reflect.defineProperty(e,n,{...r,value:i})}return e},getSpawnedPromise:e=>new Promise(((t,n)=>{e.on("exit",((e,n)=>{t({exitCode:e,signal:n})})),e.on("error",(e=>{n(e)})),e.stdin&&e.stdin.on("error",(e=>{n(e)}))}))};const yt=/ +/g;var Rt={joinCommand:(e,t=[])=>Array.isArray(t)?[e,...t].join(" "):e,parseCommand:e=>{const t=[];for(const n of e.trim().split(yt)){const e=t[t.length-1];e&&e.endsWith("\\")?t[t.length-1]=`${e.slice(0,-1)} ${n}`:t.push(n)}return t}};const{spawnedKill:St,spawnedCancel:wt,setupTimeout:bt,setExitHandler:Tt}=nt,{handleInput:Ot,getSpawnedResult:Nt,makeAllStream:Lt,validateInputSync:At}=Et,{mergePromise:xt,getSpawnedPromise:Pt}=It,{joinCommand:Ct,parseCommand:Gt}=Rt,Dt=(e,t,n={})=>{const r=me._parse(e,t,n);return e=r.command,t=r.args,(n={maxBuffer:1e8,buffer:!0,stripFinalNewline:!0,extendEnv:!0,preferLocal:!1,localDir:(n=r.options).cwd||process.cwd(),execPath:process.execPath,encoding:"utf8",reject:!0,cleanup:!0,all:!1,windowsHide:!0,...n}).env=(({env:e,extendEnv:t,preferLocal:n,localDir:r,execPath:i})=>{const o=t?{...process.env,...e}:e;return n?Ie.env({env:o,cwd:r,execPath:i}):o})(n),n.stdio=Me(n),"win32"===process.platform&&"cmd"===d.default.basename(e,".exe")&&t.unshift("/q"),{file:e,args:t,options:n,parsed:r}},Mt=(e,t,n)=>"string"==typeof t||Buffer.isBuffer(t)?e.stripFinalNewline?(e=>{const t="string"==typeof e?"\n":"\n".charCodeAt(),n="string"==typeof e?"\r":"\r".charCodeAt();return e[e.length-1]===t&&(e=e.slice(0,e.length-1)),e[e.length-1]===n&&(e=e.slice(0,e.length-1)),e})(t):t:void 0===n?void 0:"",kt=(e,t,n)=>{const r=Dt(e,t,n),i=Ct(e,t);let o;try{o=p.default.spawn(r.file,r.args,r.options)}catch(e){const t=new p.default.ChildProcess,n=Promise.reject(Ce({error:e,stdout:"",stderr:"",all:"",command:i,parsed:r,timedOut:!1,isCanceled:!1,killed:!1}));return xt(t,n)}const a=Pt(o),s=bt(o,r.options,a),c=Tt(o,r.options,s),u={isCanceled:!1};o.kill=St.bind(null,o.kill.bind(o)),o.cancel=wt.bind(null,o,u);const l=Te((async()=>{const[{error:e,exitCode:t,signal:n,timedOut:a},s,l,d]=await Nt(o,r.options,c),p=Mt(r.options,s),f=Mt(r.options,l),m=Mt(r.options,d);if(e||0!==t||null!==n){const s=Ce({error:e,exitCode:t,signal:n,stdout:p,stderr:f,all:m,command:i,parsed:r,timedOut:a,isCanceled:u.isCanceled,killed:o.killed});if(!r.options.reject)return s;throw s}return{command:i,exitCode:0,stdout:p,stderr:f,all:m,failed:!1,timedOut:!1,isCanceled:!1,killed:!1}}));return Ot(o,r.options.input),o.all=Lt(o,r.options),xt(o,l)};var jt=kt;jt.sync=(e,t,n)=>{const r=Dt(e,t,n),i=Ct(e,t);let o;At(r.options);try{o=p.default.spawnSync(r.file,r.args,r.options)}catch(e){throw Ce({error:e,stdout:"",stderr:"",all:"",command:i,parsed:r,timedOut:!1,isCanceled:!1,killed:!1})}const a=Mt(r.options,o.stdout,o.error),s=Mt(r.options,o.stderr,o.error);if(o.error||0!==o.status||null!==o.signal){const e=Ce({stdout:a,stderr:s,error:o.error,signal:o.signal,exitCode:o.status,command:i,parsed:r,timedOut:o.error&&"ETIMEDOUT"===o.error.code,isCanceled:!1,killed:null!==o.signal});if(!r.options.reject)return e;throw e}return{command:i,exitCode:0,stdout:a,stderr:s,failed:!1,timedOut:!1,isCanceled:!1,killed:!1}},jt.command=(e,t)=>{const[n,...r]=Gt(e);return kt(n,r,t)},jt.commandSync=(e,t)=>{const[n,...r]=Gt(e);return kt.sync(n,r,t)},jt.node=(e,t,n={})=>{t&&!Array.isArray(t)&&"object"==typeof t&&(n=t,t=[]);const r=Me.node(n),i=process.execArgv.filter((e=>!e.startsWith("--inspect"))),{nodePath:o=process.execPath,nodeOptions:a=i}=n;return kt(o,[...a,e,...Array.isArray(t)?t:[]],{...n,stdin:void 0,stdout:void 0,stderr:void 0,stdio:r,shell:!1})};var Ut=G((function(e,t){var n;t=e.exports=d,n="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var r=Number.MAX_SAFE_INTEGER||9007199254740991,i=t.re=[],o=t.src=[],a=t.tokens={},s=0;function c(e){a[e]=s++}c("NUMERICIDENTIFIER"),o[a.NUMERICIDENTIFIER]="0|[1-9]\\d*",c("NUMERICIDENTIFIERLOOSE"),o[a.NUMERICIDENTIFIERLOOSE]="[0-9]+",c("NONNUMERICIDENTIFIER"),o[a.NONNUMERICIDENTIFIER]="\\d*[a-zA-Z-][a-zA-Z0-9-]*",c("MAINVERSION"),o[a.MAINVERSION]="("+o[a.NUMERICIDENTIFIER]+")\\.("+o[a.NUMERICIDENTIFIER]+")\\.("+o[a.NUMERICIDENTIFIER]+")",c("MAINVERSIONLOOSE"),o[a.MAINVERSIONLOOSE]="("+o[a.NUMERICIDENTIFIERLOOSE]+")\\.("+o[a.NUMERICIDENTIFIERLOOSE]+")\\.("+o[a.NUMERICIDENTIFIERLOOSE]+")",c("PRERELEASEIDENTIFIER"),o[a.PRERELEASEIDENTIFIER]="(?:"+o[a.NUMERICIDENTIFIER]+"|"+o[a.NONNUMERICIDENTIFIER]+")",c("PRERELEASEIDENTIFIERLOOSE"),o[a.PRERELEASEIDENTIFIERLOOSE]="(?:"+o[a.NUMERICIDENTIFIERLOOSE]+"|"+o[a.NONNUMERICIDENTIFIER]+")",c("PRERELEASE"),o[a.PRERELEASE]="(?:-("+o[a.PRERELEASEIDENTIFIER]+"(?:\\."+o[a.PRERELEASEIDENTIFIER]+")*))",c("PRERELEASELOOSE"),o[a.PRERELEASELOOSE]="(?:-?("+o[a.PRERELEASEIDENTIFIERLOOSE]+"(?:\\."+o[a.PRERELEASEIDENTIFIERLOOSE]+")*))",c("BUILDIDENTIFIER"),o[a.BUILDIDENTIFIER]="[0-9A-Za-z-]+",c("BUILD"),o[a.BUILD]="(?:\\+("+o[a.BUILDIDENTIFIER]+"(?:\\."+o[a.BUILDIDENTIFIER]+")*))",c("FULL"),c("FULLPLAIN"),o[a.FULLPLAIN]="v?"+o[a.MAINVERSION]+o[a.PRERELEASE]+"?"+o[a.BUILD]+"?",o[a.FULL]="^"+o[a.FULLPLAIN]+"$",c("LOOSEPLAIN"),o[a.LOOSEPLAIN]="[v=\\s]*"+o[a.MAINVERSIONLOOSE]+o[a.PRERELEASELOOSE]+"?"+o[a.BUILD]+"?",c("LOOSE"),o[a.LOOSE]="^"+o[a.LOOSEPLAIN]+"$",c("GTLT"),o[a.GTLT]="((?:<|>)?=?)",c("XRANGEIDENTIFIERLOOSE"),o[a.XRANGEIDENTIFIERLOOSE]=o[a.NUMERICIDENTIFIERLOOSE]+"|x|X|\\*",c("XRANGEIDENTIFIER"),o[a.XRANGEIDENTIFIER]=o[a.NUMERICIDENTIFIER]+"|x|X|\\*",c("XRANGEPLAIN"),o[a.XRANGEPLAIN]="[v=\\s]*("+o[a.XRANGEIDENTIFIER]+")(?:\\.("+o[a.XRANGEIDENTIFIER]+")(?:\\.("+o[a.XRANGEIDENTIFIER]+")(?:"+o[a.PRERELEASE]+")?"+o[a.BUILD]+"?)?)?",c("XRANGEPLAINLOOSE"),o[a.XRANGEPLAINLOOSE]="[v=\\s]*("+o[a.XRANGEIDENTIFIERLOOSE]+")(?:\\.("+o[a.XRANGEIDENTIFIERLOOSE]+")(?:\\.("+o[a.XRANGEIDENTIFIERLOOSE]+")(?:"+o[a.PRERELEASELOOSE]+")?"+o[a.BUILD]+"?)?)?",c("XRANGE"),o[a.XRANGE]="^"+o[a.GTLT]+"\\s*"+o[a.XRANGEPLAIN]+"$",c("XRANGELOOSE"),o[a.XRANGELOOSE]="^"+o[a.GTLT]+"\\s*"+o[a.XRANGEPLAINLOOSE]+"$",c("COERCE"),o[a.COERCE]="(^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])",c("COERCERTL"),i[a.COERCERTL]=new RegExp(o[a.COERCE],"g"),c("LONETILDE"),o[a.LONETILDE]="(?:~>?)",c("TILDETRIM"),o[a.TILDETRIM]="(\\s*)"+o[a.LONETILDE]+"\\s+",i[a.TILDETRIM]=new RegExp(o[a.TILDETRIM],"g");c("TILDE"),o[a.TILDE]="^"+o[a.LONETILDE]+o[a.XRANGEPLAIN]+"$",c("TILDELOOSE"),o[a.TILDELOOSE]="^"+o[a.LONETILDE]+o[a.XRANGEPLAINLOOSE]+"$",c("LONECARET"),o[a.LONECARET]="(?:\\^)",c("CARETTRIM"),o[a.CARETTRIM]="(\\s*)"+o[a.LONECARET]+"\\s+",i[a.CARETTRIM]=new RegExp(o[a.CARETTRIM],"g");c("CARET"),o[a.CARET]="^"+o[a.LONECARET]+o[a.XRANGEPLAIN]+"$",c("CARETLOOSE"),o[a.CARETLOOSE]="^"+o[a.LONECARET]+o[a.XRANGEPLAINLOOSE]+"$",c("COMPARATORLOOSE"),o[a.COMPARATORLOOSE]="^"+o[a.GTLT]+"\\s*("+o[a.LOOSEPLAIN]+")$|^$",c("COMPARATOR"),o[a.COMPARATOR]="^"+o[a.GTLT]+"\\s*("+o[a.FULLPLAIN]+")$|^$",c("COMPARATORTRIM"),o[a.COMPARATORTRIM]="(\\s*)"+o[a.GTLT]+"\\s*("+o[a.LOOSEPLAIN]+"|"+o[a.XRANGEPLAIN]+")",i[a.COMPARATORTRIM]=new RegExp(o[a.COMPARATORTRIM],"g");c("HYPHENRANGE"),o[a.HYPHENRANGE]="^\\s*("+o[a.XRANGEPLAIN]+")\\s+-\\s+("+o[a.XRANGEPLAIN]+")\\s*$",c("HYPHENRANGELOOSE"),o[a.HYPHENRANGELOOSE]="^\\s*("+o[a.XRANGEPLAINLOOSE]+")\\s+-\\s+("+o[a.XRANGEPLAINLOOSE]+")\\s*$",c("STAR"),o[a.STAR]="(<|>)?=?\\s*\\*";for(var u=0;u<s;u++)n(u,o[u]),i[u]||(i[u]=new RegExp(o[u]));function l(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof d)return e;if("string"!=typeof e)return null;if(e.length>256)return null;if(!(t.loose?i[a.LOOSE]:i[a.FULL]).test(e))return null;try{return new d(e,t)}catch(e){return null}}function d(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof d){if(e.loose===t.loose)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>256)throw new TypeError("version is longer than 256 characters");if(!(this instanceof d))return new d(e,t);n("SemVer",e,t),this.options=t,this.loose=!!t.loose;var o=e.trim().match(t.loose?i[a.LOOSE]:i[a.FULL]);if(!o)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+o[1],this.minor=+o[2],this.patch=+o[3],this.major>r||this.major<0)throw new TypeError("Invalid major version");if(this.minor>r||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>r||this.patch<0)throw new TypeError("Invalid patch version");o[4]?this.prerelease=o[4].split(".").map((function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<r)return t}return e})):this.prerelease=[],this.build=o[5]?o[5].split("."):[],this.format()}t.parse=l,t.valid=function(e,t){var n=l(e,t);return n?n.version:null},t.clean=function(e,t){var n=l(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null},t.SemVer=d,d.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},d.prototype.toString=function(){return this.version},d.prototype.compare=function(e){return n("SemVer.compare",this.version,this.options,e),e instanceof d||(e=new d(e,this.options)),this.compareMain(e)||this.comparePre(e)},d.prototype.compareMain=function(e){return e instanceof d||(e=new d(e,this.options)),f(this.major,e.major)||f(this.minor,e.minor)||f(this.patch,e.patch)},d.prototype.comparePre=function(e){if(e instanceof d||(e=new d(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var r=this.prerelease[t],i=e.prerelease[t];if(n("prerelease compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return f(r,i)}while(++t)},d.prototype.compareBuild=function(e){e instanceof d||(e=new d(e,this.options));var t=0;do{var r=this.build[t],i=e.build[t];if(n("prerelease compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return f(r,i)}while(++t)},d.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var n=this.prerelease.length;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);-1===n&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},t.inc=function(e,t,n,r){"string"==typeof n&&(r=n,n=void 0);try{return new d(e,n).inc(t,r).version}catch(e){return null}},t.diff=function(e,t){if(g(e,t))return null;var n=l(e),r=l(t),i="";if(n.prerelease.length||r.prerelease.length){i="pre";var o="prerelease"}for(var a in n)if(("major"===a||"minor"===a||"patch"===a)&&n[a]!==r[a])return i+a;return o},t.compareIdentifiers=f;var p=/^[0-9]+$/;function f(e,t){var n=p.test(e),r=p.test(t);return n&&r&&(e=+e,t=+t),e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1}function m(e,t,n){return new d(e,n).compare(new d(t,n))}function h(e,t,n){return m(e,t,n)>0}function E(e,t,n){return m(e,t,n)<0}function g(e,t,n){return 0===m(e,t,n)}function v(e,t,n){return 0!==m(e,t,n)}function I(e,t,n){return m(e,t,n)>=0}function y(e,t,n){return m(e,t,n)<=0}function R(e,t,n,r){switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return g(e,n,r);case"!=":return v(e,n,r);case">":return h(e,n,r);case">=":return I(e,n,r);case"<":return E(e,n,r);case"<=":return y(e,n,r);default:throw new TypeError("Invalid operator: "+t)}}function S(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof S){if(e.loose===!!t.loose)return e;e=e.value}if(!(this instanceof S))return new S(e,t);n("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===w?this.value="":this.value=this.operator+this.semver.version,n("comp",this)}t.rcompareIdentifiers=function(e,t){return f(t,e)},t.major=function(e,t){return new d(e,t).major},t.minor=function(e,t){return new d(e,t).minor},t.patch=function(e,t){return new d(e,t).patch},t.compare=m,t.compareLoose=function(e,t){return m(e,t,!0)},t.compareBuild=function(e,t,n){var r=new d(e,n),i=new d(t,n);return r.compare(i)||r.compareBuild(i)},t.rcompare=function(e,t,n){return m(t,e,n)},t.sort=function(e,n){return e.sort((function(e,r){return t.compareBuild(e,r,n)}))},t.rsort=function(e,n){return e.sort((function(e,r){return t.compareBuild(r,e,n)}))},t.gt=h,t.lt=E,t.eq=g,t.neq=v,t.gte=I,t.lte=y,t.cmp=R,t.Comparator=S;var w={};function b(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof b)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new b(e.raw,t);if(e instanceof S)return new b(e.value,t);if(!(this instanceof b))return new b(e,t);if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map((function(e){return this.parseRange(e.trim())}),this).filter((function(e){return e.length})),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function T(e,t){for(var n=!0,r=e.slice(),i=r.pop();n&&r.length;)n=r.every((function(e){return i.intersects(e,t)})),i=r.pop();return n}function O(e){return!e||"x"===e.toLowerCase()||"*"===e}function N(e,t,n,r,i,o,a,s,c,u,l,d,p){return((t=O(n)?"":O(r)?">="+n+".0.0":O(i)?">="+n+"."+r+".0":">="+t)+" "+(s=O(c)?"":O(u)?"<"+(+c+1)+".0.0":O(l)?"<"+c+"."+(+u+1)+".0":d?"<="+c+"."+u+"."+l+"-"+d:"<="+s)).trim()}function L(e,t,r){for(var i=0;i<e.length;i++)if(!e[i].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(i=0;i<e.length;i++)if(n(e[i].semver),e[i].semver!==w&&e[i].semver.prerelease.length>0){var o=e[i].semver;if(o.major===t.major&&o.minor===t.minor&&o.patch===t.patch)return!0}return!1}return!0}function A(e,t,n){try{t=new b(t,n)}catch(e){return!1}return t.test(e)}function x(e,t,n,r){var i,o,a,s,c;switch(e=new d(e,r),t=new b(t,r),n){case">":i=h,o=y,a=E,s=">",c=">=";break;case"<":i=E,o=I,a=h,s="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(A(e,t,r))return!1;for(var u=0;u<t.set.length;++u){var l=t.set[u],p=null,f=null;if(l.forEach((function(e){e.semver===w&&(e=new S(">=0.0.0")),p=p||e,f=f||e,i(e.semver,p.semver,r)?p=e:a(e.semver,f.semver,r)&&(f=e)})),p.operator===s||p.operator===c)return!1;if((!f.operator||f.operator===s)&&o(e,f.semver))return!1;if(f.operator===c&&a(e,f.semver))return!1}return!0}S.prototype.parse=function(e){var t=this.options.loose?i[a.COMPARATORLOOSE]:i[a.COMPARATOR],n=e.match(t);if(!n)throw new TypeError("Invalid comparator: "+e);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new d(n[2],this.options.loose):this.semver=w},S.prototype.toString=function(){return this.value},S.prototype.test=function(e){if(n("Comparator.test",e,this.options.loose),this.semver===w||e===w)return!0;if("string"==typeof e)try{e=new d(e,this.options)}catch(e){return!1}return R(e,this.operator,this.semver,this.options)},S.prototype.intersects=function(e,t){if(!(e instanceof S))throw new TypeError("a Comparator is required");var n;if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||(n=new b(e.value,t),A(this.value,n,t));if(""===e.operator)return""===e.value||(n=new b(this.value,t),A(e.semver,n,t));var r=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),i=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),o=this.semver.version===e.semver.version,a=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),s=R(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),c=R(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return r||i||o&&a||s||c},t.Range=b,b.prototype.format=function(){return this.range=this.set.map((function(e){return e.join(" ").trim()})).join("||").trim(),this.range},b.prototype.toString=function(){return this.range},b.prototype.parseRange=function(e){var t=this.options.loose;e=e.trim();var r=t?i[a.HYPHENRANGELOOSE]:i[a.HYPHENRANGE];e=e.replace(r,N),n("hyphen replace",e),e=e.replace(i[a.COMPARATORTRIM],"$1$2$3"),n("comparator trim",e,i[a.COMPARATORTRIM]),e=(e=(e=e.replace(i[a.TILDETRIM],"$1~")).replace(i[a.CARETTRIM],"$1^")).split(/\s+/).join(" ");var o=t?i[a.COMPARATORLOOSE]:i[a.COMPARATOR],s=e.split(" ").map((function(e){return function(e,t){return n("comp",e,t),e=function(e,t){return e.trim().split(/\s+/).map((function(e){return function(e,t){n("caret",e,t);var r=t.loose?i[a.CARETLOOSE]:i[a.CARET];return e.replace(r,(function(t,r,i,o,a){var s;return n("caret",e,t,r,i,o,a),O(r)?s="":O(i)?s=">="+r+".0.0 <"+(+r+1)+".0.0":O(o)?s="0"===r?">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":">="+r+"."+i+".0 <"+(+r+1)+".0.0":a?(n("replaceCaret pr",a),s="0"===r?"0"===i?">="+r+"."+i+"."+o+"-"+a+" <"+r+"."+i+"."+(+o+1):">="+r+"."+i+"."+o+"-"+a+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+o+"-"+a+" <"+(+r+1)+".0.0"):(n("no pr"),s="0"===r?"0"===i?">="+r+"."+i+"."+o+" <"+r+"."+i+"."+(+o+1):">="+r+"."+i+"."+o+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+o+" <"+(+r+1)+".0.0"),n("caret return",s),s}))}(e,t)})).join(" ")}(e,t),n("caret",e),e=function(e,t){return e.trim().split(/\s+/).map((function(e){return function(e,t){var r=t.loose?i[a.TILDELOOSE]:i[a.TILDE];return e.replace(r,(function(t,r,i,o,a){var s;return n("tilde",e,t,r,i,o,a),O(r)?s="":O(i)?s=">="+r+".0.0 <"+(+r+1)+".0.0":O(o)?s=">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":a?(n("replaceTilde pr",a),s=">="+r+"."+i+"."+o+"-"+a+" <"+r+"."+(+i+1)+".0"):s=">="+r+"."+i+"."+o+" <"+r+"."+(+i+1)+".0",n("tilde return",s),s}))}(e,t)})).join(" ")}(e,t),n("tildes",e),e=function(e,t){return n("replaceXRanges",e,t),e.split(/\s+/).map((function(e){return function(e,t){e=e.trim();var r=t.loose?i[a.XRANGELOOSE]:i[a.XRANGE];return e.replace(r,(function(r,i,o,a,s,c){n("xRange",e,r,i,o,a,s,c);var u=O(o),l=u||O(a),d=l||O(s),p=d;return"="===i&&p&&(i=""),c=t.includePrerelease?"-0":"",u?r=">"===i||"<"===i?"<0.0.0-0":"*":i&&p?(l&&(a=0),s=0,">"===i?(i=">=",l?(o=+o+1,a=0,s=0):(a=+a+1,s=0)):"<="===i&&(i="<",l?o=+o+1:a=+a+1),r=i+o+"."+a+"."+s+c):l?r=">="+o+".0.0"+c+" <"+(+o+1)+".0.0"+c:d&&(r=">="+o+"."+a+".0"+c+" <"+o+"."+(+a+1)+".0"+c),n("xRange return",r),r}))}(e,t)})).join(" ")}(e,t),n("xrange",e),e=function(e,t){return n("replaceStars",e,t),e.trim().replace(i[a.STAR],"")}(e,t),n("stars",e),e}(e,this.options)}),this).join(" ").split(/\s+/);return this.options.loose&&(s=s.filter((function(e){return!!e.match(o)}))),s=s.map((function(e){return new S(e,this.options)}),this)},b.prototype.intersects=function(e,t){if(!(e instanceof b))throw new TypeError("a Range is required");return this.set.some((function(n){return T(n,t)&&e.set.some((function(e){return T(e,t)&&n.every((function(n){return e.every((function(e){return n.intersects(e,t)}))}))}))}))},t.toComparators=function(e,t){return new b(e,t).set.map((function(e){return e.map((function(e){return e.value})).join(" ").trim().split(" ")}))},b.prototype.test=function(e){if(!e)return!1;if("string"==typeof e)try{e=new d(e,this.options)}catch(e){return!1}for(var t=0;t<this.set.length;t++)if(L(this.set[t],e,this.options))return!0;return!1},t.satisfies=A,t.maxSatisfying=function(e,t,n){var r=null,i=null;try{var o=new b(t,n)}catch(e){return null}return e.forEach((function(e){o.test(e)&&(r&&-1!==i.compare(e)||(i=new d(r=e,n)))})),r},t.minSatisfying=function(e,t,n){var r=null,i=null;try{var o=new b(t,n)}catch(e){return null}return e.forEach((function(e){o.test(e)&&(r&&1!==i.compare(e)||(i=new d(r=e,n)))})),r},t.minVersion=function(e,t){e=new b(e,t);var n=new d("0.0.0");if(e.test(n))return n;if(n=new d("0.0.0-0"),e.test(n))return n;n=null;for(var r=0;r<e.set.length;++r){e.set[r].forEach((function(e){var t=new d(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":n&&!h(n,t)||(n=t);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+e.operator)}}))}if(n&&e.test(n))return n;return null},t.validRange=function(e,t){try{return new b(e,t).range||"*"}catch(e){return null}},t.ltr=function(e,t,n){return x(e,t,"<",n)},t.gtr=function(e,t,n){return x(e,t,">",n)},t.outside=x,t.prerelease=function(e,t){var n=l(e,t);return n&&n.prerelease.length?n.prerelease:null},t.intersects=function(e,t,n){return e=new b(e,n),t=new b(t,n),e.intersects(t)},t.coerce=function(e,t){if(e instanceof d)return e;"number"==typeof e&&(e=String(e));if("string"!=typeof e)return null;var n=null;if((t=t||{}).rtl){for(var r;(r=i[a.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&r.index+r[0].length===n.index+n[0].length||(n=r),i[a.COERCERTL].lastIndex=r.index+r[1].length+r[2].length;i[a.COERCERTL].lastIndex=-1}else n=e.match(i[a.COERCE]);if(null===n)return null;return l(n[2]+"."+(n[3]||"0")+"."+(n[4]||"0"),t)}})),_t={busySignal:null,serviceName:"busy-signal",consumer:function(t){var n=this;return this.busySignal=t.create(),new e.Disposable((function(){n.busySignal=null}))},add:function(e){try{this.busySignal.add(e)}catch(e){T.log("Busy Signal has failed",e)}},remove:function(e){void 0===e&&(e="");try{this.busySignal.remove(e)}catch(e){T.log("Busy Signal has failed",e)}},clear:function(){try{this.busySignal.clear()}catch(e){T.log("Busy Signal has failed",e)}},dispose:function(){try{this.busySignal.dispose()}catch(e){T.log("Busy Signal has failed",e)}}},Ft={timeout:3e5};function $t(e){T.log(e?"Hiding update indicator":"Showing update indicator"),document.querySelector("style#"+w)||document.head.insertAdjacentHTML("beforeend",'<style id="'+w+'"></style>'),document.querySelector("style#"+w).textContent="\n    .package-updates-status-view {\n      display: "+(e?"none !important;":"inline")+"\n     }\n  "}function Bt(e){return void 0===e&&(e=!1),y(this,void 0,void 0,(function(){var t,n,r=this;return R(this,(function(i){switch(i.label){case 0:if(!e&&!function(){var e=Math.floor((new Date).getTime()/1e3),t=(r=localStorage.getItem(w+".lastUpdateTime")||0,Math.floor(new Date(r).getTime()/1e3)),n=Number(x("intervalMinutes"));var r;if(60*n>=e-t)return T.log("The next update is due in "+Math.round((60*n-(e-t))/60)+" minutes"),!1;return!0}())return[2];t="Checking for updates",_t.add(t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Ht()];case 2:return n=i.sent(),[3,4];case 3:return i.sent(),_t.remove(t),atom.notifications.addError("Could not retrieve outdated packages, see the console for details"),[2];case 4:return n.length?[4,Promise.allSettled(n.map((function(e){return y(r,void 0,void 0,(function(){return R(this,(function(t){switch(t.label){case 0:return[4,Xt(e)];case 1:return[2,t.sent()]}}))}))})))]:(T.log("No outdated packages found"),_t.remove(t),[2]);case 5:return function(e){var t=x().notifications;if(!t.notifyOnUpdate)return;var n=["Automatically updated"],r=e.slice(0,t.maximumPackageDetail).map((function(e){return"**"+e+"**"})),i=e.slice(t.maximumPackageDetail);e.length>t.maximumPackageDetail&&i.length&&r.push(i.length+" other "+(i.length>1?"packages":"package"));n.push(Vt(r));var o=atom.notifications.addSuccess(n.join(" "),{dismissable:!t.dismissNotification,buttons:!t.dismissNotification&&[{text:"Restart",onDidClick:function(){return y(this,void 0,void 0,(function(){return R(this,(function(e){switch(e.label){case 0:return o.dismiss(),[4,atom.restartApplication()];case 1:return e.sent(),[2]}}))}))}},{text:"Cancel",onDidClick:function(){o.dismiss()}}]})}(i.sent().filter((function(e){return e})).map((function(e){return e.value}))),localStorage.setItem(w+".lastUpdateTime",(new Date).toISOString()),_t.remove(t),[2]}}))}))}function Xt(e){return y(this,void 0,void 0,(function(){var t,n;return R(this,(function(r){switch(r.label){case 0:t=atom.packages.getApmPath(),r.label=1;case 1:return r.trys.push([1,3,,4]),T.log("Updating '"+e+"'"),[4,jt(t,["update",e,"--no-confirm"],Ft)];case 2:return r.sent(),[3,4];case 3:throw r.sent(),n="Failed to install '"+e+"'",T.error(n),Error(n);case 4:return[2,e]}}))}))}function Vt(e){for(var t="",n=[],r=0;r<e.length;r++){var i=e[r];r>0&&(t+=r+1<e.length?", ":" and "),n.push(t+=i)}return t}function Ht(){return y(this,void 0,void 0,(function(){var e,t,n,r,i,o,a;return R(this,(function(s){switch(s.label){case 0:T.log("Retrieving outdated packages"),e=atom.packages.getApmPath(),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,jt(e,["update","--compatible","--json","--list"],Ft)];case 2:return t=s.sent(),[3,4];case 3:throw n=s.sent(),Error(n.message);case 4:return r=JSON.parse(t.stdout).map((function(e){return{name:e.name,version:e.version,latestVersion:e.latestVersion}})).filter((function(e){return function(e){return x("versionRange").includes(((e,t)=>{if(e=Ut.parse(e),t=Ut.parse(t),!(Ut.compareBuild(e,t)>=0))return Ut.diff(e,t)||"build"})(e.version,e.latestVersion))}(e)}))||[],i=x(),o=i.includedPackages,a=i.excludedPackages,o.length?(T.log("Including packages for update: "+Vt(o)),r=r.filter((function(e){return o.includes(e.name)}))):a.length&&(T.log("Excluding packages from update: "+Vt(a)),r=r.filter((function(e){return!a.includes(e.name)}))),[2,r.map((function(e){return e.name}))]}}))}))}function qt(){var e=x(),t=e.includedPackages,n=e.excludedPackages;t.length&&n.length&&atom.notifications.addWarning("The `includedPackages` and `excludedPackages` settings are in conflict, you can only use one of them.",{dismissable:!0})}var Kt={config:A,subscriptions:new e.CompositeDisposable,updateInterval:null,activate:function(){var e=this;T.log("Activating package"),this.subscriptions.add(atom.commands.add("atom-workspace",{"auto-update-plus:update-now":function(){return y(e,void 0,void 0,(function(){return R(this,(function(e){switch(e.label){case 0:return[4,Bt(!0)];case 1:return e.sent(),[2]}}))}))}}),atom.config.observe(w+".includedPackages",qt),atom.config.observe(w+".excludedPackages",qt),atom.config.observe(w+".hideUpdateStatusView",$t)),this.migrate();var t=x();T.log("Defering action by "+t.deferInitialization+" seconds"),setTimeout((function(){return y(e,void 0,void 0,(function(){return R(this,(function(e){switch(e.label){case 0:return[4,Bt()];case 1:return e.sent(),this.enableUpdateInterval(),[2]}}))}))}),1e3*t.deferInitialization)},migrate:function(){P("dismissNotification","notifications.dismissNotification"),P("maximumPackageDetail","notifications.maximumPackageDetail"),P("updateNotification","notifications.notifyOnUpdate"),function(e){void 0===e&&(e="");var t=(null==e?void 0:e.length)?S+"."+e:S;T.log("Unsetting configuration setting '"+t),atom.config.unset(t)}("notificationStyle")},enableUpdateInterval:function(){var e=this,t=Number(x("intervalMinutes"));T.log("Setting interval to "+t+" "+(1===t?"minute":"minutes")),this.updateInterval=setInterval((function(){return y(e,void 0,void 0,(function(){return R(this,(function(e){switch(e.label){case 0:return[4,Bt()];case 1:return e.sent(),[2]}}))}))}),60*t*1e3),this.configSubscription=atom.config.onDidChange(w+".intervalMinutes",(function(t){var n=t.newValue;T.log("Changed update interval to "+n+" minutes",n),e.disableUpdateInterval(),e.enableUpdateInterval()}))},disableUpdateInterval:function(){var e;null===(e=this.configSubscription)||void 0===e||e.dispose(),this.configSubscription=null,this.updateInterval&&(T.log("Clearing interval"),clearInterval(this.updateInterval)),this.updateInterval=null},consumeSignal:function(e){T.log("Consuming Busy Signal service"),_t.consumer(e)},deactivate:function(){var e;T.log("Deactivating package"),null===(e=this.subscriptions)||void 0===e||e.dispose()}};module.exports=Kt;
//# sourceMappingURL=index.js.map
